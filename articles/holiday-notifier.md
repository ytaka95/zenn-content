---
title: "社内向け休日通知botを作った"
emoji: "🇯🇵"
type: "tech"
topics: ["ChatGPT", "Slack", "AWS"]
published: true
published_at: 2023-12-06
---

社内で「朝出社したら誰もいなくて、そこで初めて祝日だったことに気づいた」という話を聞きました。なんということでしょうか。せめて前日には気づかせてあげたいと思い、祝日を通知するSlack Botを作成しました。

----

この記事は[株式会社オプティマインド](https://www.optimind.tech/)の社員による「Optimind Advent Calendar 2023」の6日目の記事です。

https://qiita.com/advent-calendar/2023/optimind

## 全体の構成

ざっくりと以下のような構成です。元データはGitHubへ手動アップロード＆編集。Event BridgeでLambdaを定期実行してSlack Appから通知という流れです。

![](/images/holiday-notifier/kosei.png)

ちょっとこだわったのは、この手のシステムは頻繁に保守を行わないため内部構造や仕組みが忘れられがちであることから、あえてコード量を減らすなどして直感的に理解しやすい設計を意識しました。インフラもコード化しておりませんし、データの準備やメンテナンスも手動ですが、それらは上記の構成図から概ねイメージできるようになっているのではないかと思います。

## 祝日の取得

祝日の情報をどこからどう取得するかは重要です。１つの選択肢としてはみなさまおなじみのGoogleカレンダーがあります。以下のようにGoogleカレンダーのAPIで取得することができるようです。

https://zenn.dev/gas/articles/1b0e98bd4e8797

https://www.aura-office.co.jp/blog/php-get-holiday/

しかし祝日は国が決めていますし、わざわざGoogleが整備したものを取得するよりも一次情報を取ってきたほうが気持ちいいですよね（？）。 あとAPIを叩く処理を書きたくないというのもあります。

ということで国が公開している祝日一覧を探してみたらちゃんとありました。

https://www8.cao.go.jp/chosei/shukujitsu/gaiyou.html

HTMLでテーブルになっている他、「昭和30年（1955年）から令和6年（2024年）国民の祝日」がCSVで公開されています。最高ですね。

CSVでもいいんですが私は普段JSONでデータを扱うことが多いので今後のためにもJSONに直しておきたいです。けどCSVからJSONの変換ツールを作るのも面倒くさい。ということで面倒くさい単純作業を何も文句も言わずサクサクと作業してくれるあの御方にお願いしてみました。

![](/images/holiday-notifier/chatgpt.png)

すばらしいですね（間違いが無いかどうかを目視で確認する必要がありますが）。

もちろんCSVを渡してJSONに変換してもらうとか、変換ツールを作ってもらうとかもできますが、まずChatGPTを試す意図があったというのと、あとは年１回くらいの作業なのでそこまで自動化しなくてよいこと、ツールをコーディングしてしまうとその保守が面倒であることなどがあり、今回はあえて上記の方法でやってみました。

## データ管理方法

実際は祝日だけではなく会社独自の休日（主に年末年始やお盆など）があるため、それも上記のデータに入れ込む必要があります。これはさすがにAPI化などされていないので、手で付け足すことにします。また祝日が急遽変わることなどもあるかもしれません。そこでデータの手修正を行うためにこのデータはGitHubで管理し変更履歴やPRでのレビューを行えるようにしました。

また後述しますが、データの処理自体はAWS上で行うため、GitHubへPushしたらS3バケットへアップロードするGitHub Actionsも設定しております。

## 通知内容と処理

祝日情報が取れたので、あとはこれを元に好きに処理します。

処理はAWS Lambdaで行い、データはS3から都度ダウンロードします。ファイルはそこまで大きくなく、また１日１回の処理と低頻度であるため、データは実行のたびにダウンロードするようにしています。

通知内容としては、祝日かどうかだけではなく土日と繋がって連休になった場合に次の出勤日を通知したいと思ったので、以下のような処理を組みました。

1. 今日は祝日または土日である → 何も通知しない
1. 明日から順に祝日でも土日でもない日になるまで１日ずつ辿る
    - もし辿った中に祝日しかない（つまりただの土日） → 何も通知しない
1. 明日からいつまで休みで、次の出勤日がいつかを通知

## 通知方法

AWS LambdaからSlack AppのWebhookで通知を行っています。詳細なSlack Appの構築方法については解説しませんが、単純にWebhook URLを発行してLambdaの環境変数に設定しているだけです。

公式ドキュメントはこちら。

https://api.slack.com/messaging/webhooks

以下でも大変わかりやすく説明されています。

https://zenn.dev/hotaka_noda/articles/4a6f0ccee73a18

## まとめ

GitHub, AWS, Slackを使って、以下のように祝日や連休を知らせてくれるbotを作成しました。

![](/images/holiday-notifier/slack_message.png)

あえてコーディングや自動化などを捨てることで長期的な保守がしやすくなるようにも意識してみました。私が所属するチームに限らず、こうして便利なツールを自分たちで作って改善しようという動きは社内で活発に行われており、とても良い環境だなと思います。

## さいごに

この記事は [Optimind Advent Calendar 2023](https://qiita.com/advent-calendar/2023/optimind) の6日目の記事でした。

https://qiita.com/advent-calendar/2023/optimind

オプティマインドでは「多様性が進んだ世の中でも、全ての人に物が届く世界を持続可能にする」という物流業界の壮大な社会課題を解決すべく、一緒に働く仲間を大募集中です。少しでも興味が湧いた方はカジュアル面談も大歓迎ですので、気軽にお声がけください！

https://recruit.optimind.tech/
