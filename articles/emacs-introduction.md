---
title: "Emacsの良いところ"
emoji: "🐿️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Emacs"]
published: true
publication_name: optimind
---

最近ふと会社で「Emacsの紹介をしてほしい」と依頼を受けました。私は大学時代からかれこれ10年くらいEmacsを使っていますが、好き嫌いがはっきり出そうなツールなのであまり他人にEmacsを強く推薦するつもりはありませんでした。しかし紹介を依頼されて、たしかにどんな知識も知らないというのは勿体ないことだし、知りたいと思ったときに知れないというのはもっと勿体ないなと思いました。

自分でもEmacsって何が良いんだろう、ということは昔からあまりはっきりと言語化してこなかったですし、良い機会なので私の観点でEmacsの良さを書いていこうと思います。Emacsのことを知りたいと思った人の助けになれば幸いです。

## 免責

Vimなどの他のエディタやIDE等と優劣をつけるものではありません。どんなツールも好みのものを使えばいいと思います。

もしかしたらEmacsを使うことやEmacsを使う人に対して失礼な表現があるかもしれません。事実から大きく外れたことは書かれていないと思いますが、もし読んでいて気分を害された方がいたらコメントをください。

## Emacsを使い始めるまで

まずはEmacsを使えるようになるまでをまとめておきます。いやいや普通に最初から良いところを書けばいいじゃないかと思われるかもしれません。一理あります。しかしEmacsにはEmacsをEmacsらしく使うために必要な準備があります（それがデフォルトで実現されていないというのがまたEmacsらしさがありますね）。そういった事前準備無しにEmacsを触ってみて「使えねえな」となってしまっては大変もったいないです。

ということでまずは使い始めるまでに必要な儀式をご紹介します。せっかくなので今読んでいただいているあなたも一緒にインストール＆設定をしてもらえるといい感じにサンクコストが発生して引き返しづらくなってEmacs沼にハマっていく確率が高まるのでおすすめです。

### インストール

インストール方法はいろいろありますので[公式サイト](https://www.gnu.org/software/emacs/download.html)をご覧ください。

私はMacを使っておりHomebrewでインストールしています。もちろんソースからビルドもできますがまずは普通にパッケージマネージャから入れることをおすすめします。公式GitリポジトリからHEADをcloneしてビルドすることもできますが、それは後からでもできるのでまずはパッケージマネージャから入れましょう。

Homebrewの中でもいろいろと派生がありますが一旦は以下のコマンドで入れて特に問題無いかと思います。

```sh
brew install emacs
```

Linuxであれば `apt` や `dnf` にてどうぞ。Windowsは最近の事情は詳しくありませんが昔はあまり快適に使えなかった気もするので、今だとWSLで動くLinuxでインストールするほうがいいかもしれません（未検証）。WSLでもLinuxのGUIアプリケーションも動かせるようです。

### 最低限の設定

インストールしてそのままでも使えますが、１つだけ入れておいた方が良い設定があります。おそらく99.9%以上のEmacsユーザーが（本質的に同じ設定を）入れているはずです（要出典）。いずれ設定することになるので、ここで設定しておきましょう。

内容は `Control + h` でカーソルの１つ前の文字を消すというキーバインドの設定です（要はMacのdelete、WidnowsのBackspace）。後述しますがEmacsは基本的にホームポジションですべてが完結します。deleteキーまで指を伸ばすのは論外です。

以下を `~/.emacs.d/init.el` に記述します。このファイルはEmacsの設定ファイルであり起動時に自動で読み込まれるものです。今後、設定類は基本的にこのファイルに記述していくことになります。

```lisp
(define-key key-translation-map [?\C-h] [?\C-?])
```

参考: [Backspace Key | EmacsWiki](https://www.emacswiki.org/emacs/BackspaceKey)

### 起動方法

これはインストール方法にも依存しますし、GUI版を使うかターミナル内で使うかにも依存します。上記の通りのbrewコマンドで入れた場合、ターミナル内で以下のコマンドを打つと起動できます。

```sh
emacs
```

ターミナル版を起動するなら以下を打ちます。

```sh
emacs -nw
```

アプリケーションフォルダなどに入っている場合もあると思いますのでご自身の環境でご確認ください。

ちなみにターミナル版もGUI版もどちらも一長一短あるので好きな方を使えばよいです。私は使い始めてから10年以上ターミナル版を使っていましたが、最近は気まぐれでGUI版を使っています。どちらでも良いと思います。

### Controlキーの設定

後述しますがEmacsの大きな特徴の１つとしてControlキーの活用があります。これによってあらゆる操作をキーボード上のホームポジションで行うという神体験が実現されています。そのためEmacsを使う間は、左手の小指でControlキーを押す回数や時間が非常に多くなります。

MacのJISキーボードではAキーの左側はControlキーになっていてEmacsととても相性がいいです。その場合は特に何も気にすること無くそのままお使いください。

![JISキーボードにおけるControlキーの位置](/images/emacs-introduction/keyboard.webp =300x)
*MacのJISキーボードではControlはAの左にある*

一方、MacのUSキーボードや一般的なWindows向けキーボードではControlキーはホームポジションから微妙に押しづらい位置にあります。正直これではEmacsは使いづらくて仕方ないと思います。OSの設定などでAキーの左隣をControlキーとするように設定することを強くおすすめします（というかそれをしないならEmacsを使わない方が良いと思います）。

![USキーボードにおけるCapsLockキーの設定変更](/images/emacs-introduction/keyboard_settings.webp)
*Macの場合はシステム環境設定から装飾キーの動作を変更できる*

## Emacsの良いところ

さて、これでようやくEmacsが最低限使える状態になったはずです。並の人間ならここに辿り着くまでに我に返ってVSCodeでも開いていることでしょう。ここを読んでいるあなたは特殊な素質を持った稀有な人間です。おめでとうございます。

以下ではEmacs特有の（と思われる）、かつ私がEmacsを使う理由でもある特長を３つご紹介します。

### すべての操作がホームポジションで完結する

まずEmacsといえば何と言ってもこれではないでしょうか。マウス、矢印キー、バックスペースなど、ホームポジションから離れるような操作は原則行いません。基本的なものを以下に紹介します。ただしここで `C-x` というのは「Controlを押しながらxを押す」という操作を表します。

まずはカーソル移動です。

- `C-f` : 右
- `C-b` : 左
- `C-p` : 上
- `C-n` : 下

これでホームポジションからカーソル移動ができます。

他によく行う操作として以下があります。

- `C-a` : 行頭へ移動
- `C-e` : 行末へ移動
- `C-k` : 行末までを削除
- `C-y` : 行末まで削除した文字列を貼り付け
- `C-d` : カーソル上の文字を消す（Windowsでいうdeleteキーに相当）

ちなみにこれらのキーバインドはMacの多くのアプリでも利用ができます（前述の `C-h` も）。特にブラウザのテキストエリアやターミナルでは大概使うことができますので、Emacsに慣れれば他のアプリでも素早くテキスト編集ができるようになります。またControlとの組み合わせで発動するので、キーバインドを設定できるようなアプリにおいて上記の操作を割り当てれば同じように使えます。

あと使う上で知っておいた方がいいものは以下くらいでしょうか。実際に使ってみる場合はご参照ください。

:::details その他の必須操作
- `C-g` : キャンセル。困ったらこれを連打。
- `C-s` : 文字列検索。
- `C-r` : 文字列検索（バックワード）。ターミナルでも使える。
- `C-_` : Undo。環境によってはアンダーバーでも機能する。ターミナルでも使える。
- `C-x C-f` : ファイルを開く。
- `C-x C-s` : ファイルを保存する。
- `C-x C-c` : Emacsを終了する。
:::

まだまだ書ききれないくらい多くの便利なキー操作があります。また後述するようにプログラミング言語で機能を記述可能であり、さらにそれらを任意のキー操作に割り当てることもできます。Emacsの無限の可能性の片鱗を感じていただけるのではないでしょうか。


### すべてをバッファとして扱える

すべてをバッファとして扱えます。何を言っているかわからないと思います。例を示します。

例えばGitで管理しているプロジェクトにおける開発中、昔の変更で消してしまった箇所の一部分を復元したくなった、という場面を考えます。いろいろ方法はあるかと思いますが、例えば以下のような手順が考えられます。

1. Gitクライアントで対象のコミットを探す
1. 対象のコミットの差分を表示する
1. 該当箇所をコピーする
1. エディタにペーストする

GitクライアントとしてSourceTreeとかForkとかGitKrakenとかGitHubとかgitコマンドとかいろいろありますが、実はEmacsにもGitクライアントがあります。私は [magit](https://magit.vc/) というものを使っています。Emacs上のクライアントを使うと何が良いのかというと、Gitのあらゆる操作をEmacsのバッファで表現されるので、Emacsのキーバインドがそのまま使えるのです。

例えばEmacs上で git log を表示すると、普段のコード上での文字列検索と同じ方法でコミットメッセージの検索ができます。そして対象コミットの差分を表示したら、普段と同じ方法でコピーしたい部分の範囲選択やコピーができます。

操作イメージを動画にしましたが伝わらないかもしれないので見なくても大丈夫です。

https://youtu.be/UG2eLIl0ldI

もちろんこれはGitクライアントに限りませんし、検索やコピペにも限りません。あらゆるツールをEmacs上で動かすことにより、ツールを切り替えることによるコンテキストスイッチが必要なく、ツールごとに操作方法を考える手間も最小限にすることができ、効率よく本質的な作業に集中することができるのです。

### Lispで何でも書ける

Emacsは外部拡張によりさまざまな機能追加やカスタマイズを行うことができます。拡張機能と聞けば今どきは当たり前感もありますが、Emacsの場合はユーザー設定からあらゆるカスタマイズをすべて一貫して Emacs Lisp というLispベースの言語で書くことができるというのが特徴です。

具体的に何が良いのかという話ですが、まず設定がプログラミング言語で書けるというのはとても便利です。キーバインドなどの設定で条件分岐やループや関数などを使えるわけですね。毎分自動でキーバインドを変えることもできます。やりませんけど。

また、設定に慣れてきたらそのまま拡張機能が自分で作れるというのもメリットです。というか設定イコール拡張であってそこに区別は無いです。

またLispで表現できればいいので、例えばメーラー（[Mew](https://mew.org/ja/), [mu4e](https://github.com/emacsmirror/mu4e), [notmuch](https://notmuchmail.org/notmuch-emacs/)）やブラウザ（[eww](https://www.gnu.org/software/emacs/manual/html_mono/eww.html)）もEmacs上で動きます。[音楽プレイヤー](https://www.emacswiki.org/emacs/%E3%83%9F%E3%83%A5%E3%83%BC%E3%82%B8%E3%83%83%E3%82%AF%E3%83%97%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC)とかもあります。狂ってますね。ちなみにEmacsでメールをするのはわりとメジャーです。

Lispで書けてしまうので外部依存も少なくなる傾向にある気がします（要出典）。init.elファイルさえ用意しておけば、新しい環境ではそれを読み込むだけでEmacsの移行が完了します。なんなら足りない外部パッケージはLispからインストールコマンドを打ってしまってもいいわけです。

あとはスクリプト言語なので例えば誰かが作ったライブラリを手元で修正して動かしてみたりということも簡単です。[GitHub上のinit.elファイル](https://github.com/search?q=path%3A%2F%28%5E%7C%5C%2F%29init%5C.el%24%2F&type=code)を見て回るのも楽しいですね。起動後にインタラクティブに設定を上書き（式を評価）することも簡単です。選択範囲だけ評価することもできます。

Emacsにハマるとカスタマイズが楽しすぎてコーディングよりもカスタマイズの時間の方が長くなること請け合いです。

## 実例

良いところを書きましたがなかなかそれだけでは伝わりきらない部分があると思います。以下では最近私が使っているパッケージを紹介しつつ、それによりEmacsとはどういう概念のものなのか、それによりどういう体験が得られるか、ということをご紹介します。

### 基本

前述したようにGitクライアントがあったり、Language Server と連携して関数ジャンプや補完を効かせたり、プロジェクトのディレクトリ構造をツリーで表示したり、Shellを起動したり、今どきのエディタでできることは基本的にできます。というかそうしたパッケージを作って公開してくださっている方々がいます。感謝。もちろんそれぞれに対してEmacs特有のコマンド操作やカスタマイズができ、常にEmacs上で一貫した体験が実現されています。

### 組み込みAPIの置き換え

ちょっと概念にクセがありますが、例えば [consult](https://github.com/minad/consult?tab=readme-ov-file) というパッケージがあります。これはEmacs内蔵の対話システムをより便利にするものです。例えばデフォルトではファイルを開くとき（ `C-x C-f` ）は以下の画像のようにパスの入力行だけが出てきて、一覧や候補を出すにはTABを押す必要があります。consultを入れることで最初からリスト表示され、文字を入力するごとに絞り込みが行われます（ちなみに実際はもっと多機能なパッケージですので、気になる方はGitHubのREADMEや他の解説記事をご覧ください）。

![consultが無いときのfind-file](/images/emacs-introduction/minibuffer_normal_small.webp)
*デフォルトでは一行だけしか出ない*

![consultが有るときのfind-file](/images/emacs-introduction/minibuffer_consult_small.webp)
*勝手に一覧表示や絞り込みなどをしてくれる*

さらにここでは [marginalia](https://github.com/minad/marginalia) を使ってファイル名の右側に情報を出していたり、[orderless](https://github.com/oantolin/orderless) を使って検索を柔軟にしていたりします。

このように、Emacsの組み込み機能（API）を使っている部分を外部パッケージで置き換えてより便利にするということが可能です。こうするとEmacs全体の体験を一貫性を保ちながら変化（底上げ）させることができます。

### 外部ツールとの連携

当然ながら拡張はすべてLispで完結している必要は無く、外部コマンドを呼び出すことも可能です。そのようなツールをいくつかご紹介します。

#### oj

https://conao3.com/blog/2020-db66-daf0/

競技プログラミングに参加するのに便利な [oj](https://github.com/online-judge-tools/oj/tree/master) というツールをラップするパッケージです。例えば参加対象のコンテストのIDを入れることでディレクトリ構造の初期化、サンプル入力のダウンロードができ、さらにテストや提出などもすべてEmacs上のコマンドで実行できます。厳しい時間制限や深い思考力を求められる競プロにおいて、ターミナルやブラウザに移動することなく最低限の操作で完結するというのは非常に重要ではないでしょうか。

#### zenn-cli

Zennの公式ツールであるzenn-cliをラップするパッケージです。

https://zenn.dev/wurly/articles/ac5bc9a9d9bdd7

私はこれに細かいカスタマイズを施して使わせてもらっています。例えば以下のように関連するコマンド一覧を表示するメニュー機能を作ったり（コマンドって忘れがちですよね）。

![関連コマンドを一覧表示する](/images/emacs-introduction/zenn-cli-menu.webp)

記事一覧をバッファではなくミニバッファで開いたり（こうすると前述したconsultの便利機能が使えます）。

![記事一覧をミニバッファで表示する](/images/emacs-introduction/zenn-cli-list.webp)

こうしたカスタマイズも普段の設定と同じように Emacs Lisp でできますし、エディタの再起動などせず試行錯誤ができます。簡単にできるのはメリットですね。

## さいごに

Emacsの良さと利用イメージのご紹介をしました。いろいろと書きましたが、結局は使ってみないとこの体験の良さは伝わらないと思います。ここまで読んだ方は相当Emacsに興味を持っている変人だと思うので、ぜひご自身でインストールして沼に飛び込んでみてください。
