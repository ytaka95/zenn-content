---
title: "Emacsの良いところ"
emoji: "🐿️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Emacs"]
published: true
publication_name: optimind
---

最近ふと会社で「Emacsの紹介をしてほしい」と依頼を受けました。私は大学時代からかれこれ10年くらいEmacsを使っていますが、好き嫌いがはっきり出そうなツールなのであまり他人にEmacsを強く推薦するつもりはありませんでした。しかし紹介を依頼されて、たしかにどんな知識も知らないというのは勿体ないことだし、知りたいと思ったときに知れないというのはもっと勿体ないなと思いました。

自分でもEmacsって何が良いんだろう、ということは昔からあまりはっきりと言語化してこなかったですし、良い機会なので私の観点でEmacsの良さを書いていこうと思います。Emacsのことを知りたいと思った人の助けになれば幸いです。

## 免責

Vimなどの他のエディタやIDE等と優劣をつけるものではありません。どんなツールも好みのものを使えばいいと思います。

もしかしたらEmacsを使うことやEmacsを使う人に対して失礼な表現があるかもしれません。事実から大きく外れたことは書かれていないと思いますが、もし読んでいて気分を害された方がいたらコメントをください。

## Emacsを使い始めるまで

まずはEmacsを使えるようになるまでをまとめておきます。いやいや普通に最初から良いところを書けばいいじゃないかと思われるかもしれません。一理あります。しかしEmacsにはEmacsを便利に使うための推奨設定というものがあります（それがデフォルトで実現されていないというのがまたEmacsらしさがありますね）。そういった事前準備無しにEmacsを触ってみて「使えねえな」となってしまっては大変もったいないです。

ということでまずは使い始めるまでに必要な儀式をご紹介します。せっかくなので今読んでいただいているあなたも一緒にインストール＆設定をしてもらえるといい感じにサンクコストが発生して引き返しづらくなってEmacs沼にハマっていく確率が高まるのでおすすめです。

### インストール

インストール方法はいろいろありますので[公式サイト](https://www.gnu.org/software/emacs/download.html)をご覧ください。

私はMacを使っておりHomebrewでインストールしています。もちろんソースからビルドもできますが普通にパッケージマネージャから入れることをおすすめします。毎日公式Gitリポジトリからcloneしてビルドすることもできますがそれは後からでもできますのでまずはパッケージマネージャから入れましょう。

Homebrewの中でもいろいろと派生がありますが一旦は以下のコマンドで入れて特に問題無いかと思います。

```sh
brew install emacs
```


### 最低限の設定

インストールしてそのままでも使えますが、１つだけ入れておいた方が良い設定があります。おそらく99.9%以上のEmacsユーザーが（本質的に同じ設定を）入れているはずです（要出典）。いずれ設定することになるので、ここで設定しておきましょう。

内容は `Control + h` でカーソルの１つ前の文字を消す（つまりバックスペースを入力する）というキーバインドの設定です。後述しますがEmacsは基本的にホームポジションですべてが完結します。バックスペースキーまで指を伸ばすのは論外です。

以下を `~/.emacs.d/init.el` に記述します。このファイルはEmacsの設定ファイルであり起動時に自動で読み込まれるものです。今後、設定類は基本的にこのファイルに記述していくことになります。

```lisp
(keyboard-translate ?\C-h ?\C-?)
```

余談ですが、普通にキーバインドを設定する場合は別の関数（`global-set-key` など）を使うことが一般的です。ただこの件に関してはちょっと特殊な便利設定をしておいたほうがいいので（検索や補完などの中でも機能させるため） `keyboard-translate` を使っています。もっと良い方法があるという方はぜひコメントをください。

### 起動方法

これはインストール方法にも依存しますし、GUI版を使うかターミナル内で使うかにも依存します。上記の通りのbrewコマンドで入れた場合、ターミナル内で以下のコマンドを打つと起動できます。

```sh
emacs
```

これでおそらくGUI版が起動するはずです。環境によってそうではないかもしれません。またはアプリケーションフォルダなどに入っている場合もあると思います。環境やインストール方法によります。

明示的にターミナル版を起動するなら以下を打ちます。

```sh
emacs -nw
```

ターミナル版もGUI版もどちらも一長一短あるので好きな方を使えばよいです。

GUI版だとウインドウサイズとかフォントとかをいじれますし、マウスポインタを使うこともできます（使うかどうかはおいておいて）。ターミナルの設定との切り分けや相性に惑わされることも減るかもしれません。例えばTrueColorとかキーバインドとか。

逆にターミナル版であれば見た目はターミナル側で制御できるのでEmacsで設定しなくていいというメリットもあります（欧文フォントと日本語フォントの幅の比率とか）。あと私の環境特有かもしれませんが、ターミナル版の方が起動が早い気がします。基本的に立ち上げっぱなしにするなら関係ないですが。

私は使い始めてから10年以上ターミナル版を使っていましたが、最近は気まぐれでGUI版を使っています。どちらでも良いと思います。

### Controlキーの設定

後述しますがEmacsの大きな特徴の１つとしてControlキーの活用があります。これによってあらゆる操作をキーボード上のホームポジションで行うという神体験が実現されています。そのためEmacsを使う間は、左手の小指でControlキーを押す回数や時間が非常に多くなります。

MacのJISキーボードではAキーの左側はControlキーになっていてEmacsととても相性がいいです。その場合は特に何も気にすること無くそのままお使いください。

![JISキーボードにおけるControlキーの位置](/images/emacs-introduction/keyboard.webp =300x)
*MacのJISキーボードではControlはAの左にある*

一方、MacのUSキーボードや一般的なWindows向けキーボードではControlキーはホームポジションから微妙に押しづらい位置にあります。正直これではEmacsは使いづらくて仕方ないと思います。OSの設定などでAキーの左隣をControlキーとするように設定することを強くおすすめします（というかそれをしないならEmacsを使わない方が良いと思います）。

![USキーボードにおけるCapsLockキーの設定変更](/images/emacs-introduction/keyboard_settings.webp)
*Macの場合はシステム環境設定から装飾キーの動作を変更できる*

## Emacsの良いところ

さて、これでようやくEmacsが最低限使える状態になったはずです。並の人間ならここに辿り着くまでに我に返ってVSCodeでも開いていることでしょう。ここを読んでいるあなたは特殊な素質を持った稀有な人間です。おめでとうございます。

以下ではEmacs特有の（と思われる）、かつ私がEmacsを使う理由でもある特長を３つご紹介します。

### キーバインド

まずEmacsといえば何と言ってもこれではないでしょうか。先述しましたがEmacsでは基本的にすべての操作をホームポジションで実施することができます。マウス、矢印キー、バックスペースなど、ホームポジションから離れるような操作は原則行いません。基本的なものを以下に紹介します。ただしここで `C-x` というのは「Controlを押しながらxを押す」という操作を表します。

まずはカーソル移動です。

- `C-f` : 右
- `C-b` : 左
- `C-p` : 上
- `C-n` : 下

これでホームポジションからカーソル移動ができます。

他によく行う操作として以下があります。

- `C-a` : 行頭へ移動
- `C-e` : 行末へ移動
- `C-k` : 行末までを削除
- `C-y` : 行末まで削除した文字列を貼り付け
- `C-d` : カーソル上の文字を消す（Windowsでいうdeleteキーに相当）

ちなみにこれらのキーバインドはMacの多くのアプリでも利用ができます（前述の `C-h` も）。特にブラウザのテキストエリアやターミナルでは大概使うことができますので、Emacsに慣れれば他のアプリでも素早くテキスト編集ができるようになります。モード切り替えが必須であるVimとは違うポイントですね。

あと使う上で知っておいた方がいいものは以下くらいでしょうか。実際に使ってみる場合はご参照ください。

:::details その他の必須操作
- `C-g` : キャンセル。困ったらこれを連打。
- `C-s` : 文字列検索。
- `C-r` : 文字列検索（バックワード）。ターミナルでも使える。
- `C-_` : Undo。環境によってはアンダーバーでも機能する。ターミナルでも使える。
- `C-x C-f` : ファイルを開く。
- `C-x C-s` : ファイルを保存する。
- `C-x C-c` : Emacsを終了する。

Emacsでは `C-x` がプレフィックスとしてよく使われます。ただ個人的に `C-x` は押しづらいので別のキーに割り当ててます（ `C-j` とか）。
:::

まだまだ書ききれないくらい多くの便利なキー操作があります。また後述するようにプログラミング言語で機能を記述可能であり、さらにそれらを任意のキー操作に割り当てることもできます。Emacsの無限の可能性の片鱗を感じていただけるのではないでしょうか。


### すべてをバッファとして扱える

すべてをバッファとして扱えます。何を言っているかわからないと思います。私もどう表現していいかわかりませんでしたので例を示します。

例えばGitで管理しているプロジェクトにおける開発中、昔の変更で消してしまった箇所の一部分を復元したくなった、という場面を考えます。いろいろ方法はあるかと思いますが、例えば以下のような手順が考えられます。

1. Gitクライアントで対象のコミットを探す
1. 対象のコミットの差分を表示する
1. 該当箇所をコピーする
1. エディタにペーストする

GitクライアントとしてSourceTreeとかForkとかGitKrakenとかGitHubとかgitコマンドとかいろいろありますが、実はEmacsにもGitクライアントがあります。私は [magit](https://magit.vc/) というものを使っています。Emacs上のクライアントを使うと何が良いのかというと、Emacsの機能やキーバインドがそのまま使えるのです。

例えばEmacs上で git log を表示すると、普段のコード上での文字列検索と同じ方法でコミットメッセージの検索ができます。そして対象コミットの差分を表示したら、普段と同じ方法でコピーしたい部分の範囲選択やコピーができます。

https://youtu.be/UG2eLIl0ldI

ツールを切り替えることによるコンテキストスイッチも必要なく、ツールごとにどうやればいいかということを考える手間も最小限にすることができ、効率よく本質的な作業に集中することができるのです。

### Lispで何でも書ける

Emacsは外部拡張によりさまざまな機能追加やカスタマイズを行うことができます。拡張機能と聞けば今どきは当たり前感もありますが、Emacsの場合はユーザー設定からあらゆるカスタマイズをすべて一貫して Emacs Lisp というLispベースの言語で書くことができるというのが特徴です。

具体的に何が良いのかという話ですが、まず設定がプログラミング言語で書けるというのはとても便利です。キーバインドなどの設定で条件分岐やループや関数などを使えるわけですね。毎分自動でキーバインドを変えることもできます。やりませんけど。ちなみに前述した `Control + h` の設定も、よく見ると関数に２つの引数を渡しているという形ですね。

```lisp
;; keyboard-translate という関数を呼び出している
(keyboard-translate ?\C-h ?\C-?)
```

また、設定に慣れてきたらそのまま拡張機能が自分で作れるというのもメリットです（というか設定イコール拡張であってそこに区別は無いです）。

またLispで表現できればいいので、例えばメーラー（[Mew](https://mew.org/ja/), [mu4e](https://github.com/emacsmirror/mu4e), [notmuch](https://notmuchmail.org/notmuch-emacs/)）やブラウザ（[eww](https://www.gnu.org/software/emacs/manual/html_mono/eww.html)）もEmacs上で動きます。[音楽プレイヤー](https://www.emacswiki.org/emacs/%E3%83%9F%E3%83%A5%E3%83%BC%E3%82%B8%E3%83%83%E3%82%AF%E3%83%97%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC)とかもあります。狂ってますね。ちなみにEmacsでメールをするのはわりとメジャーです。

Lispで書けてしまうので外部依存も少なくなる傾向にある気がしてます（要出典）。init.elファイルさえ用意しておけば、新しい環境ではそれを読み込むだけでEmacsの以降が完了します。

あとはスクリプト言語なので例えば誰かが作ったライブラリを手元で修正して動かしてみたりということも簡単です。[GitHub上のinit.elファイル](https://github.com/search?q=path%3A%2F%28%5E%7C%5C%2F%29init%5C.el%24%2F&type=code)を見て回るのも楽しいですね。起動後にインタラクティブに設定を上書き（式を評価）することも簡単です。選択範囲だけ評価とかもできます。

Emacsにハマるとカスタマイズが楽しすぎてコーディングよりもカスタマイズの時間の方が長くなること請け合いです。

## 実例紹介

以下では最近私が使っている外部パッケージを紹介しつつそれによりどういう体験が得られるかということをご紹介します。Emacsを使うことでどういった世界が待っているかということを少しでもイメージしていただければと思います。

冒頭にも書きましたがほかのエディタ類と比較をして優劣を述べるものではありませんし、またEmacsにしかできないことしか書かないというわけでもありません。それVimでもできますよ。それVSCodeでもできますよ。そうですね。できますね。

### magit

前述したGitクライアントです。過去のコミット検索とかブランチ移動とか行ごとのstageとかいろいろEmacs上でできるのは大変便利です。ただしキーを１つ押しただけで操作が進むので誤操作には注意です。

### neotree

https://github.com/jaypei/emacs-neotree

プロジェクトのディレクトリ構造をツリー状に表示します。VSCodeなんかにもついている機能ですね。これももちろんEmacsの検索コマンドがつかえるので普段の流れでファイル検索（というかもはやカーソル移動）が可能です。

![neotreeの利用イメージ](/images/emacs-introduction/neotree.webp)
*左側にファイルツリーが表示されている*

### consult

https://github.com/minad/consult?tab=readme-ov-file

ちょっと概念にクセがありますが、Emacs内蔵の対話システムをより便利にするものです。例えばデフォルトではファイルを開くとき（ `C-x C-f` ）は以下の画像のようにパスの入力行だけが出てきて、一覧や候補を出すにはTABを押す必要があります。consultを入れることで最初からリスト表示され、文字を入力するごとに絞り込みが行われます。ちなみに実際はもっと多機能なパッケージですので、気になる方はGitHubのREADMEや他の解説記事をご覧ください。

![consultが無いときのfind-file](/images/emacs-introduction/minibuffer_normal.webp)
*デフォルトでは一行だけしか出ない*

![consultが有るときのfind-file](/images/emacs-introduction/minibuffer_consult.webp)
*勝手に一覧表示や絞り込みなどをしてくれる*

### eglot (LSP)

https://github.com/joaotavora/eglot

これはあまり特筆することでもないですが、Language Server ももちろんあります。補完や関数ジャンプなどが可能です。

### zenn-cli

Zennの記事を書くために公式のzenn-cliというものがnpmで公開されていますが、これをラップする拡張を有志の方が作成されています。

https://zenn.dev/wurly/articles/ac5bc9a9d9bdd7

私はこれに細かいカスタマイズを施して使わせてもらっています（例えば記事一覧をミニバッファで開くなど）。こうしたカスタマイズも簡単にできるのはメリットですね。もちろんライセンス違反にはお気をつけください。

### oj

https://conao3.com/blog/2020-db66-daf0/

競技プログラミングに参加するのに便利な機能を備えたものです。例えば参加対象のコンテストのIDを入れることでディレクトリ構造の初期化、サンプル入力のダウンロード、などをすべて自動で行ってくれます。またテストや提出も可能です。厳しい時間制限や深い思考力を求められる競プロにおいて、ターミナルやブラウザに移動することなく最低限の操作で完結するというのは非常に重要ではないでしょうか。

## さいごに

Emacsについていろいろとご紹介をしてきました。いろいろと書きましたが、結局は使ってみないとこの体験の良さは伝わらないかなと思います。ここまで読んだ方は相当Emacsに興味を持っている変人だと思うので、ぜひご自身でインストールして沼に飛び込んでみていただきたいです。ハマったら最高の人生が待っています。ハマらなかったらアンインストールすればOKです。ぜひ。

ちなみに、以下のコミュニティでそれぞれオープンなSlackが運営されています。

- [emacs-jp](https://emacs-jp.github.io/#slack---emacs-jpslackcom)
- [vim-jp](https://vim-jp.org/docs/chat.html)

Emacsについての質問や雑談などができます（vim-jpでEmacsの話というのも不思議な感じがしますが、ちゃんと `#tech-emacs` チャンネルがあります）。初心者にも優しい世界なのでぜひお気軽にご参加してコミュニティを盛り上げていただければと思います。ちなみに私はまだ見る専です。シャイなんです。ごめんなさい。
